# 測定器としての使用ガイド

このWebAudio実装を実際の無線機測定に使用するためのガイド。

## DAC選定

疑似音声発生器として使うには、PCからアナログ音声を出力するDACが必要。USBオーディオインターフェースやUSBヘッドフォンアンプが該当する（入力機能は不要）。

### 選定基準

| 項目 | 最低要件 | 推奨 |
|------|----------|------|
| THD+N | -80dB以下 | -100dB以下 |
| サンプリング | 44.1kHz | 48kHz |
| 分解能 | 16bit | 24bit |
| 出力 | ライン出力あり | バランス出力 |

THD+Nが重要な理由：疑似音声の周波数特性精度がフィルタ設計で0.3%以下なので、DACの歪みがこれを上回ると意味がない。-80dB（0.01%）あれば十分だが、余裕を見て-100dB以下を推奨。

### 機器例

**Focusrite Scarlett Solo（約2万円）**
- THD+N: -109dB（ライン出力）
- 周波数特性: 20-20kHz ±0.02dB
- 最大出力: 16dBu（バランス）

**ASUS Xonar U7 MKII（約1万円）**
- THD+N: -104dB
- S/N比: 114dB
- 出力: 1Vrms

**TASCAM US-2x2HR（約2.2万円）**
- THD+N: -98dB
- 周波数特性: 20Hz-20kHz +0.2/-0.1dB
- 最大出力: +20dBu（7.75Vrms）

いずれもスペックシートが公開されており、測定用途に必要な情報が確認できる。

## 接続

```
PC (Browser) ──USB── DAC ──Audio Cable── 無線機 (マイク入力)
```

### ケーブル

- TRS-3.5mm：バランス出力DAC → 無線機
- RCA-3.5mm：アンバランス出力DAC → 無線機
- XLR-3.5mm：XLR出力DAC → 無線機（必要に応じて）

## セットアップ

1. DACをUSB接続（通常ドライバ不要）
2. OSのオーディオ出力をDACに設定
3. サンプルレート: 48kHz/24bit推奨
4. ブラウザでアプリを開く（Chrome 67+、Firefox 76+）

## 校正

### 必要機器
- オシロスコープまたはAC電圧計

### サンプルレート設定
- **OS側**: 48kHz/24bit または 44.1kHz に設定
- **DAC側**: 設定したサンプルレートへの対応を確認
- **ブラウザ**: 自動的にOSの設定を使用。本アプリは 44.1kHz と 48kHz の両方に最適化されたフィルタ係数を内蔵しており、実行時に自動的に切り替わります。

### 手順

1. **基準信号出力**: 1000Hz正弦波、-20dB程度
2. **測定**: オシロで波形確認、RMS値を記録、歪みがないことを確認
3. **調整**: 目標レベル（一般的な無線機マイク入力: 10-100mVrms）に合わせる

### レベル調整の原則

信号経路の前段で十分なレベルを確保し、後段で絞る。

1. **PC/WebAudio**: 大きめに設定（S/N比確保）
2. **DAC出力**: 機器により調整
3. **無線機マイクゲイン**: 微調整のみ

各段で歪まない範囲で前段を大きくすることで、全体のS/N比が向上する。

## 測定例：SSB送信機

### 準備
1. 送信機をSSB(USB)モードに設定
2. マイク入力に疑似音声を接続
3. 送信機出力 → 減衰器 → スペクトラムアナライザ

### 測定
1. 疑似音声出力開始
2. PTT押下
3. 占有帯域幅を測定
4. スプリアスを測定

## トラブルシューティング

### 50/60Hzハム音
グラウンドループが原因。対策：
- アイソレーショントランス
- USB絶縁アダプタ
- 1点アース

### 送信時の音質劣化
RF回り込みが原因。対策：
- フェライトコア装着
- シールドケーブル使用
- 送信機との物理的距離確保
